<!doctype html>
<html>
  <head>
      <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
  </head>
  <body>
    <script src="./prevalences.js"></script>
    <script type="text/javascript">

      prevalences = {'BA.2.1': 0.0021267791567892457, 'BA.2.10': 0.0011135310111479249, 'BA.2.10.4': 6.793961647372365e-05, 'BA.2.12': 0.00013221286609991313, 'BA.2.3.16': 5.893691912494859e-05, 'BA.2.32': 6.607750281222569e-05, 'BA.2.86': 0.010297476096073515, 'BA.2.86.1': 0.08009444557964987, 'CH.1.1.1': 5.264717404496827e-05, 'DV.7.1.4': 0.00039708001299942273, 'EG.10': 0.00012124062952754531, 'EG.10.1': 0.0020940124024079283, 'EG.11': 0.005370100651776719, 'EG.13': 0.0016498730148106124, 'EG.2': 0.05370240362257358, 'EG.2.5': 0.0002014736900012032, 'EG.5': 0.006609383852320069, 'EG.5.1': 0.043788199092538616, 'EG.5.1.1': 0.013788405097188438, 'EG.5.1.14': 0.0030806909952761853, 'EG.5.1.19': 0.0011945536512295413, 'EG.5.1.2': 0.0010334333851537453, 'EG.5.1.3': 0.012391741694682283, 'EG.5.1.4': 0.006282618828912035, 'EG.5.1.6': 0.02951327049493265, 'EG.5.1.7': 0.0016139088475524254, 'EG.5.1.8': 0.0016720937368977509, 'EG.5.2': 7.419049414005725e-05, 'EG.6': 0.00013350829659867407, 'EG.6.1': 0.0003653949686831286, 'EG.9.1': 7.682980994384869e-05, 'FL.1': 0.00038266972685035733, 'FL.1.4': 0.00030744829060821787, 'FL.1.5': 0.00018202685019305266, 'FL.1.5.1': 0.020318149352591044, 'FL.1.5.2': 0.00013755965668814537, 'FL.10.1': 0.0007656621797112934, 'FL.12': 9.557527421572052e-05, 'FL.13.4.1': 0.0027247759105542397, 'FL.15': 0.0033746010802600443, 'FL.18': 0.0019887744890305955, 'FL.2': 0.0002010100726187592, 'FL.20.2': 0.00629395775431993, 'FL.24.1': 0.0009000096874576433, 'FL.25': 0.010313180948755994, 'FL.26': 0.000286884736332561, 'FL.4.8': 0.0022264967094460172, 'FP.3': 0.0005955538925751783, 'FT.3': 0.0003053263750408224, 'FT.3.1': 0.0011872191787990994, 'FU.2': 0.006973681858616095, 'FU.2.1': 0.0002453442469526009, 'FW.1': 0.007801320500725741, 'FY.5': 0.007988241423638234, 'FY.5.4': 0.0010200109791186625, 'FY.5.5.1': 0.0006915836928171028, 'GE.1': 0.0005964949024999499, 'GE.1.1': 0.0001628804744431158, 'GE.1.2.1': 0.00039708001299942273, 'GE.1.3': 0.0009489080709829499, 'GG.1': 0.0030141330964665795, 'GK.1': 0.0007748147871297526, 'GK.1.1': 0.0011329765229982829, 'GK.1.4': 0.0005515423874059247, 'GK.1.8': 0.000851281761550935, 'GK.2': 0.011295579771265909, 'GK.2.1': 0.0006300546087318764, 'GK.2.4': 0.00031875343097458205, 'GK.3.1': 0.0007787018009396005, 'GS.4': 0.004149520239380294, 'GV.1': 0.006036579417925122, 'GW.5.3': 0.0106811435728245, 'GW.5.3.1': 0.013140090163524954, 'HF.1': 0.0019431672055970166, 'HF.1.1': 0.0008499999891166055, 'HF.1.2': 0.0024259923201507983, 'HK.1': 0.0007771304043098461, 'HK.1.2': 0.00711354078205971, 'HK.11': 0.0004071870874511322, 'HK.13.1': 0.0015428654543680378, 'HK.20.1': 0.0032401066161148054, 'HK.26': 0.005354533473725205, 'HK.3': 0.027319062218880995, 'HK.3.1': 0.026972928018507328, 'HK.3.2': 0.0008269466739605878, 'HK.3.4': 0.0033077866958423512, 'HK.31': 0.00039708001299942273, 'HK.4': 0.00039397720341539813, 'HK.8': 0.0008250158440891236, 'HN.1': 0.0029543715681106366, 'HN.3': 0.001986324110285515, 'HN.5': 0.00031875343097458205, 'HS.1': 0.0023790871014881918, 'HV.1': 0.1447367675935669, 'HV.1.1': 0.015355039019078512, 'HV.1.2': 0.0022216001614950966, 'HV.1.4': 0.0009000096874576433, 'HV.1.6': 0.0008212556352203096, 'HY.1': 0.00011468426378331143, 'HZ.1': 0.0037426438597159967, 'JC.5.1': 0.0003309000108328523, 'JD.1': 0.004099356887460764, 'JD.1.1': 0.018159241810470343, 'JD.1.1.1': 0.0013296005346032983, 'JD.1.1.3': 0.0008212556352203096, 'JD.1.1.6': 0.0008821977934732443, 'JD.1.1.8': 0.0006915836928171028, 'JF.1': 0.013567314797198936, 'JF.1.1': 0.0006300546087318764, 'JF.4': 0.001987030323267349, 'JG.3': 0.007334409669063178, 'JG.3.1': 0.0029457899061925636, 'JG.3.2': 0.0019447379210434845, 'JN.1': 0.08693815826698299, 'JN.1.1': 0.013358724802439733, 'JN.1.2': 0.005454845230559842, 'JN.2': 0.0057728609156513944, 'JN.3': 0.0008212556352203096, 'JN.4': 0.0007783027519629061, 'JR.1.1': 0.000851281761550935, 'XAS': 0.00036749964621271694, 'XBB': 0.018521093671999066, 'XBB.1': 0.0006368560700493177, 'XBB.1.15': 6.17959032131799e-05, 'XBB.1.16': 0.0015701651450320164, 'XBB.1.16.1': 0.00020766607969305122, 'XBB.1.16.11': 0.018380182757653362, 'XBB.1.16.12': 0.0014402418322551928, 'XBB.1.16.13': 0.00033450774460206935, 'XBB.1.16.15': 0.022205961650537148, 'XBB.1.16.16': 0.00010408376809977763, 'XBB.1.16.17': 0.007072373016267817, 'XBB.1.16.23': 0.00201437007357004, 'XBB.1.16.6': 0.019878756166550538, 'XBB.1.19.1': 6.818358441421642e-05, 'XBB.1.22': 0.000587494981597707, 'XBB.1.22.2': 0.0006412623911313995, 'XBB.1.28.1': 0.008655278656098074, 'XBB.1.41': 8.205268658104277e-05, 'XBB.1.41.1': 0.0007031012943110761, 'XBB.1.41.2': 0.0010200678518751507, 'XBB.1.42': 0.005314531081698637, 'XBB.1.42.1': 0.004897094320785581, 'XBB.1.48': 5.072235944561109e-05, 'XBB.1.5.1': 0.0003085496685835853, 'XBB.1.5.10': 0.00030208455322793735, 'XBB.1.5.100': 0.00010483972762786581, 'XBB.1.5.102': 0.00183264832587883, 'XBB.1.5.104': 9.41154616625267e-05, 'XBB.1.5.23': 0.018816385255776585, 'XBB.1.5.28': 0.005141782968549829, 'XBB.1.5.47': 0.0001660662289082144, 'XBB.1.5.59': 0.002969153076514846, 'XBB.1.5.91': 0.000932720774194342, 'XBB.1.9': 0.0006725563732369581, 'XBB.1.9.1': 0.0003825836480448991, 'XBB.1.9.2': 0.0005213497700757264, 'XBB.1.9.4': 9.321040808866559e-05, 'XBB.2.3': 0.0011988831404977287, 'XBB.2.3.11': 6.851204425520044e-05, 'XBB.2.3.3': 0.000870051213614974, 'XBB.2.4': 0.0019040620826455846, 'XCR': 0.007638893403813925}
        
      async function main() {
        const pyodide = await loadPyodide();
        await pyodide.loadPackage(["numpy","requests",
                                   "https://corsproxy.io/?https://github.com/outbreak-info/python-outbreak-info/raw/wastewater_sprint_2/wheels/frozendict-2.4.4-cp311-cp311-emscripten_3_1_46_wasm32.whl",
                                   "https://corsproxy.io/?https://github.com/outbreak-info/python-outbreak-info/raw/wastewater_sprint_2/wheels/python_outbreak_info-2.0.0-py3-none-any.whl"])
        outbreak_clustering = pyodide.runPython('from outbreak_tools import outbreak_clustering; outbreak_clustering')
        tree = outbreak_clustering.get_compressed_tree()
          
        console.log('starting clustering')

        prevalences = new Map(Object.entries(prevalences))
        clusters = outbreak_clustering.cluster_lineages(prevalences, tree)
        clusters = outbreak_clustering.gather_groups(clusters, prevalences) // optional 2nd-level clustering
        prevs = outbreak_clustering.get_agg_prevalences(clusters, prevalences)
        rootnames = outbreak_clustering.get_group_root_names(clusters)
        
        console.log(prevs.toJs())
        console.log(rootnames.toJs())
      }
      main();

    </script>
  </body>
</html>